# Open Tracker System

###Basic System Overview:

- User requested to generate token for tracking open event for email.
- URI generated by Open Tracker will be embedded into email which also contains unique token corresponding to email.
- When email is opened, request has been made to URI embedded in email which will record <i>open</i> event along with other information corresponding to email.

####Backbone of System:

<b>Database:</b> Distributed NoSQL database Cassandra

<b>Reason:</b> When data is been stored in a distributed NoSQL database, it will automatically shard the data for user. Also Cassandra allows you to do queries across the different cluster, requiring less application code to get back at the data due to which it's more naturally suited when we have to process large amounts of data. Also Cassandra provides functionality to set TTL on column as well as on table level which will help to reduce task to maintain 30 days of history.

<b>Schema:</b>
1. Table Name: token_detail
  - token: UUID
  - created_at: Unix timestamp
  - unique_action: Counter
  - total_action: Counter
  - last_unique_action_at: Unix timestamp
  - last_action_at: Unix timestamp
  
 2. Table Name: action
  - id: Primary key
  - token: Foreign key to UUID of token_detail
  - ip_address: String
  - user_agent: String
  - other: String
  - created_at: Unix timestamp
  
  
(Note: Column type is defined for Cassandra.)

####Step by step detailed system overview:

1. Create new tokens for every email.
 - UUID can be used to identify every token uniquely. Also UUID will serve purpose of primary key of the table.
 - Whenever user requests for email tracker link, row will be generated with UUID in <i>token_detail</i> table and unique URI will be returned.
2. Track open event when URI is hit.
 - When request comes with valid token, retrieve all possible details from request and save it to <i>action</i> table.
 - If request comes from new ip address, increment counter for unique action and total action. Otherwise increment counter only for total action.


####Fraud Detection
If multiple requests come from single ip address at a same time, then they are fraudulent requests as each device has unique ip address and it's very difficult to create multiple requests at the same time.
